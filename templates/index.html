<!DOCTYPE html>
<html>
<head>
    <title>Camera Control</title>
    <style>
        .control-panel {
            text-align: center;
            margin: 20px;
        }
        .button-grid {
            display: inline-grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
        }
        .control-button {
            padding: 10px;
            margin: 5px;
            cursor: pointer;
        }
        .speed-control {
            margin: 20px;
        }
        .video-feed {
            margin: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="video-feed">
        <img src="{{ url_for('video_feed') }}" width="640" height="480">
    </div>

    <div class="control-panel">
        <div class="button-grid">
            <button onclick="move('up_left')" class="control-button">↖</button>
            <button onclick="move('up')" class="control-button">↑</button>
            <button onclick="move('up_right')" class="control-button">↗</button>
            <button onclick="move('left')" class="control-button">←</button>
            <div></div>
            <button onclick="move('right')" class="control-button">→</button>
            <button onclick="move('down_left')" class="control-button">↙</button>
            <button onclick="move('down')" class="control-button">↓</button>
            <button onclick="move('down_right')" class="control-button">↘</button>
        </div>
    </div>

    <div class="speed-control">
        <label for="speed">Movement Speed (ms):</label>
        <input type="number" id="speed" name="speed" min="10" max="1000" value="50">
        <button onclick="setSpeed()">Set Speed</button>
    </div>

    <script>
        async function move(direction) {
            try {
                const formData = new FormData();
                formData.append('direction', direction);
                
                const response = await fetch('{{ url_for("move") }}', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function setSpeed() {
            try {
                const speed = document.getElementById('speed').value;
                const formData = new FormData();
                formData.append('speed', speed);
                
                const response = await fetch('{{ url_for("set_speed") }}', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Add keyboard controls
        document.addEventListener('keydown', function(event) {
            switch(event.key) {
                case 'ArrowUp':
                    event.preventDefault();
                    move('up');
                    break;
                case 'ArrowDown':
                    event.preventDefault();
                    move('down');
                    break;
                case 'ArrowLeft':
                    event.preventDefault();
                    move('left');
                    break;
                case 'ArrowRight':
                    event.preventDefault();
                    move('right');
                    break;
            }
        });
    </script>
</body>
</html>
